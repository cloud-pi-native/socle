certmanager:
  install: true
{% if DSC.ingress.tls.type != 'tlsSecret' %}
gitlab:
  webservice:
    ingress:
      tls:
        secretName: gitlab-webservice
registry:
  enabled: false
  ingress:
      enabled: false
minio:
  ingress:
    tls:
      secretName: gitlab-minio
{% else %}
gitlab:
  webservice:
    ingress:
      tls: {}
minio:
  ingress:
    tls: {}
{% endif %}
global:
  certificates:
    customCAs:
      - configMap: openshift-service-ca.crt
{% for item in DSC.additionalsCA %}
{% if item.kind == 'ConfigMap' %}
      - configMap: {{ item.name }}
{% endif %}
{% if item.kind == 'Secret' %}
      - secret: {{ item.name }}
{% endif %}
{% endfor %}
{% if DSC.exposedCA.type != 'none' %}
      - secret: exposed-ca
{% endif %}
  hosts:
    domain: {{ DSC.global.rootDomain[1:] }}
    registry:
      name: gitlab-registry.example.com
{% if GITLAB_DOMAIN %}
    gitlab:
      name: {{ GITLAB_DOMAIN }}
{% endif %}
  ingress:
    annotations:
{% for key, val in DSC.ingress.annotations.items() %}
      {{ key }}: {{ val }}
{% endfor %}
    labels:
{% for key, val in DSC.ingress.labels.items() %}
      {{ key }}: {{ val }}
{% endfor %}
    class: none
    configureCertmanager: false
    tls:
      enabled: true
{% if DSC.ingress.tls.type == 'tlsSecret' %}
      secretName: {{ DSC.ingress.tls.tlsSecret.name }}
{% endif %}
  extraEnv:
{% if DSC.proxy.enabled %}
    http_proxy: {{ DSC.proxy.http_proxy }}
    https_proxy: {{ DSC.proxy.https_proxy }}
    no_proxy: {{ DSC.proxy.no_proxy }}
    HTTP_PROXY: {{ DSC.proxy.http_proxy }}
    HTTPS_PROXY: {{ DSC.proxy.https_proxy }}
    NO_PROXY: {{ DSC.proxy.no_proxy }}
{% endif %}
  appConfig:
    ldap:
      preventSignin: true
    omniauth:
      enabled: true
      syncProfileAttributes: ["email"]
      allowSingleSignOn: ["openid_connect"]
      blockAutoCreatedUsers: false
      autoSignInWithProvider: "openid_connect"
      autoLinkLdapUser: false
      autoLinkSamlUser: false
      autoLinkUser: ["openid_connect"]
      providers:
        - secret: openid-connect
